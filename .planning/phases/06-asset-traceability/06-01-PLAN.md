---
phase: 06-asset-traceability
plan: 01
type: execute
wave: 1
depends_on: ["05-05"]
files_modified:
  - tests/test_end_to_end.py
  - tests/conftest.py
autonomous: true

must_haves:
  truths:
    - "End-to-end test runs from portfolio data to SimulationResult with deterministic outputs"
    - "Test asserts summary and failure_log are identical across repeated runs with same seed"
  artifacts:
    - path: "tests/test_end_to_end.py"
      provides: "End-to-end simulation determinism test"
  key_links:
    - from: "tests/test_end_to_end.py"
      to: "src/asset_optimization/simulation/simulator.py"
      via: "Simulator.run"
      pattern: "Simulator\(.*\)\.run"
---

<objective>
Add a true end-to-end test that starts from a portfolio dataset and validates that simulation results are deterministic and stable.

Purpose: lock in deterministic behavior before refactoring the portfolio interface and adding new tracking features.
Output: end-to-end pytest covering portfolio -> simulation -> result equality.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-asset-traceability/06-CONTEXT.md

# Current simulation entrypoints
@src/asset_optimization/portfolio.py
@src/asset_optimization/simulation/simulator.py
@src/asset_optimization/simulation/config.py
@src/asset_optimization/simulation/result.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add deterministic end-to-end test</name>
  <files>
    tests/test_end_to_end.py
    tests/conftest.py
  </files>
  <action>
1. Create a small synthetic portfolio DataFrame (5-10 assets) using existing fixtures or a new fixture in conftest.py.
2. Load the portfolio via the current portfolio interface (Portfolio.from_dataframe).
3. Run the simulator twice with the same SimulationConfig(random_seed=...) and WeibullModel.
4. Assert deterministic outputs:
   - summary DataFrames are identical
   - failure_log DataFrames are identical
   - total_cost and total_failures match
5. Do NOT involve visualization in this test.
  </action>
  <verify>
    uv run pytest tests/test_end_to_end.py -q
  </verify>
  <done>
    - End-to-end test passes
    - Test asserts deterministic results without plotting
  </done>
</task>

</tasks>
