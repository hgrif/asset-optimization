---
phase: 06-asset-traceability
plan: 04
type: execute
wave: 4
depends_on: ["06-03"]
files_modified:
  - src/asset_optimization/visualization.py
  - src/asset_optimization/__init__.py
  - tests/test_visualization.py
autonomous: true

must_haves:
  truths:
    - "Heatmap visualization shows assets x years with action-based colors and returns an Axes"
    - "Heatmap function is exported in the public API"
  artifacts:
    - path: "src/asset_optimization/visualization.py"
      provides: "plot_asset_action_heatmap function"
    - path: "tests/test_visualization.py"
      provides: "Heatmap plotting tests"
  key_links:
    - from: "src/asset_optimization/visualization.py"
      to: "src/asset_optimization/simulation/result.py"
      via: "asset_history DataFrame usage"
      pattern: "asset_history"
---

<objective>
Add an action heatmap visualization for asset-year events.

Purpose: enable quick visual inspection of actions over time.
Output: new heatmap plot function and tests.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-asset-traceability/06-CONTEXT.md

# Existing visualization patterns
@src/asset_optimization/visualization.py
@tests/test_visualization.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add asset action heatmap plot</name>
  <files>
    src/asset_optimization/visualization.py
    src/asset_optimization/__init__.py
  </files>
  <action>
1. Implement `plot_asset_action_heatmap` (name can be adjusted if needed) that accepts:
   - asset_history DataFrame or SimulationResult
   - action_col (default 'action')
   - year_col (default 'year')
   - asset_id_col (default 'asset_id')
   - action_order/palette override
   - max_assets to limit rows for large portfolios

2. Map actions to categorical codes and render using seaborn heatmap or matplotlib imshow.
3. Include a legend or colorbar with action labels.
4. Export the new function from __init__.py.
  </action>
  <verify>
    uv run pytest tests/test_visualization.py -q
  </verify>
  <done>
    - Heatmap function returns Axes
    - Action colors are stable and documented
  </done>
</task>

<task type="auto">
  <name>Task 2: Add visualization tests for heatmap</name>
  <files>
    tests/test_visualization.py
  </files>
  <action>
1. Add a small asset_history fixture (2-3 assets, 2-3 years) with varied actions.
2. Assert plot_asset_action_heatmap returns an Axes.
3. Add a validation test for missing required columns.
  </action>
  <verify>
    uv run pytest tests/test_visualization.py -q
  </verify>
  <done>
    - Heatmap plot is covered by tests
  </done>
</task>

</tasks>
