---
phase: 07.1-documentation-workflow
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - pyproject.toml
  - .pre-commit-config.yaml
  - notebooks/TEMPLATE.py
autonomous: true

must_haves:
  truths:
    - "Jupytext is installed and configured for percent-format pairing"
    - "Pre-commit hooks run ruff, standard checks, and jupytext sync on commit"
    - "A template .py file exists for future notebook authoring (phases 8-10)"
  artifacts:
    - path: "pyproject.toml"
      provides: "Jupytext config and dev dependencies"
      contains: "[tool.jupytext]"
    - path: ".pre-commit-config.yaml"
      provides: "Pre-commit hook configuration"
      contains: "jupytext"
    - path: "notebooks/TEMPLATE.py"
      provides: "Notebook template for future phases"
      contains: "# %% [markdown]"
  key_links:
    - from: "pyproject.toml"
      to: ".pre-commit-config.yaml"
      via: "jupytext installed as dev dependency enables pre-commit hook"
      pattern: "jupytext"
    - from: ".pre-commit-config.yaml"
      to: "notebooks/*.py"
      via: "pre-commit jupytext hook syncs .py to .ipynb on commit"
      pattern: "jupytext.*pre-commit"
---

<objective>
Set up the jupytext-based documentation workflow: install dependencies, configure jupytext
percent-format pairing in pyproject.toml, create .pre-commit-config.yaml with ruff + standard
hooks + jupytext sync, and provide a template .py file for future notebook authoring.

Purpose: Establish tooling so agents write .py files instead of .ipynb, with automatic conversion
on commit. This is the foundation for all migration and future doc work.

Output: Working pre-commit setup with jupytext sync, ruff linting, and a notebook template.
</objective>

<execution_context>
@/Users/henkgriffioen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henkgriffioen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07.1-documentation-workflow/07.1-CONTEXT.md
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure jupytext and pre-commit dependencies and settings</name>
  <files>pyproject.toml, .pre-commit-config.yaml</files>
  <action>
  1. Update `pyproject.toml`:
     - Add `jupytext` and `pre-commit` to the `[dependency-groups] dev` list
     - Add `ruff` to the `[dependency-groups] dev` list (needed for pre-commit ruff hook)
     - Add a `[tool.jupytext]` section with:
       ```toml
       [tool.jupytext]
       formats = "ipynb,py:percent"
       ```
     - This tells jupytext to pair .ipynb with .py percent-format files

  2. Create `.pre-commit-config.yaml` with the following hooks (matching ah-grocery-bot pattern):
     - `pre-commit/pre-commit-hooks` repo: trailing-whitespace, end-of-file-fixer, check-yaml, check-json, check-ast, debug-statements
     - `astral-sh/ruff-pre-commit` repo: ruff hook with `--fix` arg, and ruff-format hook
     - `mwouts/jupytext` repo: jupytext hook with args `["--sync"]` to sync .py <-> .ipynb on commit

     Use recent stable versions for each repo rev (pre-commit-hooks v5.0.0, ruff-pre-commit v0.9.x, jupytext v1.16.x).

  3. Run `uv sync` to install new dependencies, then run `pre-commit install` to set up the git hook.

  Note: The jupytext hook with `--sync` will automatically generate/update .ipynb files whenever
  a paired .py file is committed. Structure-only conversion (no cell execution during sync) is
  the default jupytext behavior.
  </action>
  <verify>
  Run: `uv run pre-commit --version` (confirms pre-commit installed)
  Run: `uv run jupytext --version` (confirms jupytext installed)
  Run: `grep -q "tool.jupytext" pyproject.toml` (confirms config exists)
  Run: `test -f .pre-commit-config.yaml` (confirms pre-commit config exists)
  Run: `test -f .git/hooks/pre-commit` (confirms hook installed)
  </verify>
  <done>
  pyproject.toml has jupytext config and dev dependencies. .pre-commit-config.yaml exists with
  ruff, standard hooks, and jupytext sync. Pre-commit hook is installed in .git/hooks.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create notebook template for future phases</name>
  <files>notebooks/TEMPLATE.py</files>
  <action>
  Create `notebooks/TEMPLATE.py` as a percent-format jupytext file that future phases (8-10) can
  copy when creating new documentation notebooks. Use tutorial-style tone.

  The template should include:
  - Jupytext header comment (format metadata)
  - A markdown cell with title placeholder and "what you'll learn" section
  - A markdown cell for "Setup" with imports placeholder
  - A code cell with common SDK imports pattern
  - A markdown cell numbered section placeholder (## 1. First Section)
  - A code cell placeholder for the first section
  - A markdown cell for "Summary" with key takeaways pattern
  - Comments explaining the percent-format conventions:
    - `# %% [markdown]` for markdown cells
    - `# %%` for code cells
    - Triple-quoted strings for multi-line markdown content

  Use this exact jupytext header at the top of the file:
  ```python
  # ---
  # jupyter:
  #   jupytext:
  #     text_representation:
  #       extension: .py
  #       format_name: percent
  #   kernelspec:
  #     display_name: Python 3
  #     language: python
  #     name: python3
  # ---
  ```

  Keep it concise -- this is a starting point, not comprehensive docs. Around 40-60 lines.
  Include matplotlib import in the template since all notebooks use visualizations.
  </action>
  <verify>
  Run: `test -f notebooks/TEMPLATE.py` (file exists)
  Run: `head -5 notebooks/TEMPLATE.py` (has jupytext header)
  Run: `grep -c '# %%' notebooks/TEMPLATE.py` (has multiple cell markers)
  Run: `uv run jupytext --test notebooks/TEMPLATE.py` (valid jupytext format -- if this command exists, otherwise skip)
  </verify>
  <done>
  notebooks/TEMPLATE.py exists as a valid jupytext percent-format file with placeholder structure
  that future phases can copy and customize. Contains jupytext header, markdown cells, code cells,
  and follows tutorial-style conventions.
  </done>
</task>

</tasks>

<verification>
- `uv run pre-commit run --all-files` completes (may show formatting fixes, should not error on jupytext)
- `grep "formats" pyproject.toml` shows `ipynb,py:percent`
- `.pre-commit-config.yaml` contains hooks for ruff, pre-commit-hooks, and jupytext
- `notebooks/TEMPLATE.py` is valid percent-format
</verification>

<success_criteria>
1. Jupytext is installed and configured for ipynb + py:percent pairing
2. Pre-commit hooks are installed with ruff, standard hooks, and jupytext sync
3. Template file exists and follows percent-format conventions
4. Running `pre-commit run --all-files` does not produce errors (warnings OK for existing files)
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-documentation-workflow/07.1-01-SUMMARY.md`
</output>
