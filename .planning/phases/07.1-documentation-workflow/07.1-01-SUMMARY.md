---
phase: 07.1-documentation-workflow
plan: 01
subsystem: docs-tooling
tags: [jupytext, pre-commit, ruff, notebooks, makefile]
dependency:
  requires: []
  provides:
    - jupytext pairing config
    - pre-commit hooks for ruff + jupytext
    - notebook template
    - Makefile quality gates
tech-stack:
  added:
    - jupytext: ">=1.16.0" (percent-format pairing)
    - pre-commit: ">=3.7.0" (git hooks)
    - ruff: ">=0.9.0" (lint/format hook)
  patterns:
    - jupytext ipynb/py:percent pairing
    - pre-commit hook chain for lint/format/sync
    - Makefile-driven quality gates
key-files:
  created:
    - .pre-commit-config.yaml
    - notebooks/TEMPLATE.py
    - Makefile
  modified:
    - pyproject.toml
    - AGENTS.md
    - tests/test_simulation.py
decisions:
  - id: limit-jupytext-hook-scope
    what: Restrict jupytext hook to notebooks/ only
    why: Avoid syncing non-notebook markdown files
    impact: Pre-commit jupytext runs only on notebook pairs
metrics:
  completed: 2026-02-06
---

# Phase 07.1 Plan 01: Documentation Workflow

## What Was Built

1. **Jupytext Configuration**
   - Added jupytext, pre-commit, and ruff to dev dependency groups.
   - Configured `[tool.jupytext]` with `ipynb,py:percent` pairing.

2. **Pre-commit Hooks**
   - Added standard hooks, ruff lint/format hooks, and jupytext sync.
   - Scoped jupytext hook to `notebooks/` to avoid non-notebook files.

3. **Notebook Template**
   - Created `notebooks/TEMPLATE.py` with percent-format markers, sections, and imports.

4. **Makefile Quality Gates**
   - Added `make lint` (pre-commit), `make test`, and `make docs` targets.
   - `make docs` runs the `.py` scripts, then syncs notebook pairs.
   - Updated agent instructions to require these checks after tasks.

## Deviations From Plan

- Added a Makefile and agent quality gate notes at user request.
- Removed an unused test variable to satisfy ruff.

## Blockers & Challenges

- `jupytext --test` requires `--to`, `--output`, or `--sync`; the plan’s command fails on current jupytext.
- `pre-commit run --all-files` can report “git index is outdated” if notebook pairs are updated but not staged.

## Verification Results

- `uv run pre-commit --version` (pass)
- `uv run jupytext --version` (pass)
- `grep -q "tool.jupytext" pyproject.toml` (pass)
- `.pre-commit-config.yaml` exists (pass)
- `notebooks/TEMPLATE.py` exists and has percent markers (pass)
- `uv run pre-commit run --all-files` (fails until paired notebooks are staged)

## Next Phase Readiness

- Ready for documentation work in phases 8-10 once notebook pairs are synced and staged as needed.
