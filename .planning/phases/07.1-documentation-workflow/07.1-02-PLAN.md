---
phase: 07.1-documentation-workflow
plan: 02
type: execute
wave: 2
depends_on: ["07.1-01"]
files_modified:
  - notebooks/01_quickstart.py
  - notebooks/02_proportional_hazards.py
  - notebooks/quickstart.ipynb
  - notebooks/proportional_hazards.ipynb
autonomous: true

must_haves:
  truths:
    - "quickstart.ipynb content is available as 01_quickstart.py in percent format"
    - "proportional_hazards.ipynb content is available as 02_proportional_hazards.py in percent format"
    - "Jupytext sync produces valid .ipynb files from the .py sources"
    - "Migrated content is cleaned up with improved explanations and tutorial-style tone"
  artifacts:
    - path: "notebooks/01_quickstart.py"
      provides: "Quickstart tutorial in percent format"
      contains: "# %% [markdown]"
    - path: "notebooks/02_proportional_hazards.py"
      provides: "Proportional hazards tutorial in percent format"
      contains: "# %% [markdown]"
    - path: "notebooks/quickstart.ipynb"
      provides: "Generated notebook from 01_quickstart.py (no outputs)"
    - path: "notebooks/proportional_hazards.ipynb"
      provides: "Generated notebook from 02_proportional_hazards.py (no outputs)"
  key_links:
    - from: "notebooks/01_quickstart.py"
      to: "notebooks/quickstart.ipynb"
      via: "jupytext sync generates .ipynb from .py source"
      pattern: "jupytext"
    - from: "notebooks/02_proportional_hazards.py"
      to: "notebooks/proportional_hazards.ipynb"
      via: "jupytext sync generates .ipynb from .py source"
      pattern: "jupytext"
---

<objective>
Migrate the two existing notebooks (quickstart.ipynb, proportional_hazards.ipynb) to jupytext
percent-format .py source files. Clean up content during migration (improve explanations, fix
formatting, update examples). Verify round-trip sync produces valid .ipynb files.

Purpose: Complete the migration so .py files become the source of truth. Existing .ipynb files
are regenerated from .py sources (outputs stripped -- users regenerate by running notebooks).

Output: Two .py source files and their synced .ipynb counterparts.
</objective>

<execution_context>
@/Users/henkgriffioen/.claude/get-shit-done/workflows/execute-plan.md
@/Users/henkgriffioen/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07.1-documentation-workflow/07.1-CONTEXT.md
@.planning/phases/07.1-documentation-workflow/07.1-01-SUMMARY.md
@notebooks/quickstart.ipynb
@notebooks/proportional_hazards.ipynb
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate quickstart and proportional_hazards notebooks to .py percent format</name>
  <files>notebooks/01_quickstart.py, notebooks/02_proportional_hazards.py</files>
  <action>
  Migrate both notebooks to jupytext percent-format .py files. For each notebook:

  **Method:** Read the existing .ipynb content, then write a new .py file in percent format.
  Do NOT use `jupytext --to py:percent` (it produces messy output). Write the .py files manually
  based on the notebook content, using clean percent-format conventions.

  **For notebooks/01_quickstart.py** (from quickstart.ipynb):
  - Add jupytext header metadata at top of file
  - Convert each markdown cell to `# %% [markdown]` followed by triple-quoted string
  - Convert each code cell to `# %%` followed by the code
  - Clean up content during migration:
    - Ensure tutorial-style tone (step-by-step walkthrough, guided, educational)
    - Fix any formatting issues
    - Keep all existing sections: Setup, Generate Portfolio, Validate, Deterioration Model,
      Simulation, Results, Export, Next Steps
    - Keep the cleanup cell at the end that removes temp parquet files
  - Do NOT include cell outputs (they're regenerated when users run the notebook)

  **For notebooks/02_proportional_hazards.py** (from proportional_hazards.ipynb):
  - Same percent-format conversion approach
  - Keep all sections: What is PH, Portfolio with Covariates, Baseline Model, PH Model,
    Comparing Rates, Simulation, Multiple Covariates, Covariate Requirements, Summary
  - Clean up content: ensure tutorial-style tone, clear explanations
  - Keep matplotlib visualizations (set_sdk_theme, bar charts, line plots)
  - Ensure the "strict covariates" messaging is clear (missing/NaN columns raise ValueError)

  **Percent-format conventions to follow:**
  - File starts with jupytext metadata header (# --- / jupyter: / jupytext: / etc.)
  - Markdown cells: `# %% [markdown]` then content as triple-quoted string (`"""..."""`)
  - Code cells: `# %%` then Python code
  - One blank line between cell marker and content
  - Two blank lines between cells for readability

  **Numbered prefix filenames per user decision:**
  - `01_quickstart.py` (not `quickstart.py`)
  - `02_proportional_hazards.py` (not `proportional_hazards.py`)
  </action>
  <verify>
  Run: `test -f notebooks/01_quickstart.py && test -f notebooks/02_proportional_hazards.py`
  Run: `grep -c '# %%' notebooks/01_quickstart.py` (should have 15+ cell markers)
  Run: `grep -c '# %%' notebooks/02_proportional_hazards.py` (should have 10+ cell markers)
  Run: `python -c "import ast; ast.parse(open('notebooks/01_quickstart.py').read()); print('OK')"` (valid Python)
  Run: `python -c "import ast; ast.parse(open('notebooks/02_proportional_hazards.py').read()); print('OK')"` (valid Python)
  </verify>
  <done>
  Both .py files exist in percent format with jupytext headers, clean content, tutorial-style
  tone, and all original sections preserved. Files are valid Python (parseable by ast module).
  </done>
</task>

<task type="auto">
  <name>Task 2: Sync .py sources to .ipynb and verify round-trip</name>
  <files>notebooks/quickstart.ipynb, notebooks/proportional_hazards.ipynb</files>
  <action>
  1. Remove the old .ipynb files that have embedded outputs:
     ```bash
     rm notebooks/quickstart.ipynb notebooks/proportional_hazards.ipynb
     ```

  2. Run jupytext sync to generate fresh .ipynb from the .py sources:
     ```bash
     uv run jupytext --sync notebooks/01_quickstart.py
     uv run jupytext --sync notebooks/02_proportional_hazards.py
     ```
     This should create `notebooks/01_quickstart.ipynb` and `notebooks/02_proportional_hazards.ipynb`.

     Note: The generated .ipynb files will have the numbered prefix names matching the .py sources.
     The old `quickstart.ipynb` and `proportional_hazards.ipynb` names are retired.

  3. Verify the generated .ipynb files are valid:
     ```bash
     python -c "import json; json.load(open('notebooks/01_quickstart.ipynb')); print('Valid JSON')"
     python -c "import json; json.load(open('notebooks/02_proportional_hazards.ipynb')); print('Valid JSON')"
     ```

  4. Verify the .ipynb files have the expected cell structure (markdown and code cells present):
     ```bash
     python -c "
     import json
     nb = json.load(open('notebooks/01_quickstart.ipynb'))
     cells = nb['cells']
     md_count = sum(1 for c in cells if c['cell_type'] == 'markdown')
     code_count = sum(1 for c in cells if c['cell_type'] == 'code')
     print(f'01_quickstart: {md_count} markdown, {code_count} code cells')
     assert md_count >= 5 and code_count >= 5, 'Too few cells'
     "
     ```

  5. Run `uv run pre-commit run --all-files` to verify the full pre-commit pipeline works
     with the new files. Fix any ruff linting issues that come up in the .py files.

  6. Verify existing tests still pass: `uv run pytest` (migration should not break SDK code).
  </action>
  <verify>
  Run: `test -f notebooks/01_quickstart.ipynb && test -f notebooks/02_proportional_hazards.ipynb`
  Run: `test ! -f notebooks/quickstart.ipynb` (old file removed)
  Run: `test ! -f notebooks/proportional_hazards.ipynb` (old file removed)
  Run: `uv run pytest` (all tests pass)
  Run: `uv run pre-commit run jupytext --all-files` (jupytext hook passes)
  </verify>
  <done>
  Old .ipynb files removed. New .ipynb files generated from .py sources via jupytext sync.
  Generated notebooks are valid JSON with correct cell structure. Pre-commit hooks pass.
  All existing tests pass. The .py files are now the source of truth for documentation.
  </done>
</task>

</tasks>

<verification>
- `notebooks/01_quickstart.py` exists and is valid percent-format
- `notebooks/02_proportional_hazards.py` exists and is valid percent-format
- `notebooks/01_quickstart.ipynb` exists and is valid notebook JSON generated by jupytext
- `notebooks/02_proportional_hazards.ipynb` exists and is valid notebook JSON generated by jupytext
- Old `notebooks/quickstart.ipynb` and `notebooks/proportional_hazards.ipynb` do not exist
- `uv run pre-commit run --all-files` passes
- `uv run pytest` passes (no SDK regression)
</verification>

<success_criteria>
1. Both notebooks migrated to .py percent-format source files with numbered prefixes
2. Jupytext sync generates valid .ipynb files from .py sources
3. Content is cleaned up with tutorial-style tone and improved explanations
4. Old unnumbered .ipynb files are removed
5. Pre-commit hooks pass on all files
6. Existing SDK tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-documentation-workflow/07.1-02-SUMMARY.md`
</output>
